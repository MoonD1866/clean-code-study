# 11장 시스템

## 시스템 제작과 사용 분리

시스템의 제작과 시스템 사용은 분리해야 한다.<br>
소프트웨어 관점으로, 어플리케이션 객체를 제작하고 의존성을 서로 연결하는 준비 과정과 런타임 로직을 분리해야함.<br>

예시로 초기화 지연 방식의 경우,<br>
불필요한 부하를 줄이며 null 포인터 반환이 사라진다는 잇점도 존재하나<br>
명시적 의존 상태가 만들어지며, 만약 무거운 객체라면 테스트를 위해 mock 등을 또 써야함.<br>
따라서 **생성**과 **사용**을 명확히 분리해야 한다.

## Main 분리

시스템 생성과 시스템 사용을 분리하는 방법 중 하나는 **main** 함수, 혹은 main이 호출하는 모듈에서 객체 생성 관련 코드를 모두 처리하는 것. 애플리케이션에서는 생성된 객체를 사용하는 방법만 알면 됨. 이렇게 하면 애플리케이션은 객체 생성 과정을 전혀 몰라도 된다.<br>

## 팩토리 패턴

어떤 객체가 생성되는 시점은 애플리케이션에서 결정해야 한다. main에서 **factory 객체**를 생성하여 전달할 수 있다. 만약 구체적인 구현을 숨기고 싶다면 **Abstract Factory 패턴**을 사용할 수 있다.<br>
생성 시점은 애플리케이션이 결정하지만, 생성 코드는 팩토리를 통해 관리.

## 의존성 주입

**의존성 주입(DI)**은 시스템의 **사용**과 **제작**을 분리하는 강력한 메커니즘. 의존성 주입은 **제어 역전(IoC)** 기법을 의존성 관리에 적용한 것.<br>
제어 역전에서는 한 객체가 맡은 보조 책임을 새로운 객체에게 전적으로 떠넘긴다. 이를 통해 새로운 객체는 **단일 책임 원칙(SRP)**을 지킬 수 있음.<br>

진정한 의존성 주입은 한 단계 더 나아가 완전히 수동적인 형태를 지닌다. 의존성을 필요로 하는 객체가 직접 의존성을 해결(생성, 연결)하는 대신, 생성자나 setter 메서드를 통해 **DI 컨테이너**가 해당 의존성을 해결.

## 확장

시스템이 성장하는 과정에서 **확장성**은 중요한 요소이다. 시스템이 처음부터 완벽하게 설계되어 있지 않더라도, 점진적으로 확장하는 방식이 더 현실적이다. **애자일 방식**에서처럼, 처음에는 최소한의 시스템을 구축하고, 이후에 확장하면서 필요한 구조를 점차적으로 추가해 나간다.<br>

## 횡단 관심사

**횡단 관심사(cross-cutting concerns)**는 독립적으로 분리할 수 있는 부분들이지만, 실제로는 여러 코드에 분산되어 있는 경우를 말함.<br>
AOP는 횡단 관심사를 모듈화하여 시스템을 깔끔하게 분리할 수 있는 기법.

## 자바 프록시

단순한 상황에 적합. 개별 객체나 클래스에서 메서드 호출을 감싸는 경우 등.<br>
직접 구현 시 코드가 상당히 많고 복잡해지며, 깨끗한 코드를 작성하기 어렵다. 하나 **순수 자바 AOP 프레임워크**에서는 대부분의 프록시 코드가 비슷하므로 도구로 자동화할 수 있다. 여러 자바 프레임워크는 내부적으로 프록시를 사용한다.

### 순수 자바 AOP 프레임워크

스프링은 비즈니스 논리를 **POJO**로 구현. 따라서 테스트가 개념적으로 더 쉽고 간단하다. **설정 파일**이나 **API**를 활용하여 필수적인 구조를 구현할 수 있음. 이러한 방식은 영속성, 트랜잭션, 보안, 캐시, 장애조치와 같은 **횡단 관심사**를 효과적으로 처리할 수 있게 도와준다.

## AspectJ 관점

관심사를 관점으로 분리하는 가장 강력한 도구로, 관점을 모듈화 구성으로 지원하는 자바 언어 확장임. 새로 배워야하는 단점도 있지만 어노테이션 폼 등으로 쉽게 사용 가능.

## 테스트 주도 시스템 아키텍처 구축

시스템 아키텍처를 설계할 때, **관심사 분리**는 매우 중요하다. 이를 통해 코드 수준에서 아키텍처 관심사를 분리할 수 있으며, **테스트 주도 개발(TDD)**을 통해 시스템을 점진적으로 확장할 수 있다.<br>
시스템의 각 모듈은 **POJO(Plain Old Java Object)**로 구성되며, 서로 다른 영역은 최소한의 영향을 주고받는 구조로 통합된다.

## 의사 결정을 최적화

시스템 설계에서 중요한 결정은 가능한 한 마지막 순간까지 미루는 것이 최선일 수 있다. **최선의 결정을 내리기 위해 충분한 정보**를 수집하고 고민한 후, **최적의 시점에 결정을 내리는 것**이 중요하다.<br>
**관심사를 모듈로 분리한 POJO 시스템**은 기민성을 제공하여 최신 정보를 기반으로 최적의 결정을 내리기 쉽게 만든다.

## 명백한 가치가 있을 때 표준을 현명하게 사용

표준을 무작정 따르는 것보다는, **실제 고객 가치**가 있는지 판단한 후 표준을 사용하는 것이 중요하다. 과거에는 표준을 단지 표준이라는 이유만으로 채택했던 사례들이 많았고, 이는 고객 가치를 저하시켰다.<br>
표준을 잘 사용하면 **아이디어와 컴포넌트 재사용**이 용이해지지만, 표준을 설정하는 데 너무 많은 시간이 걸린다면 **기술 발전에 뒤처질 수 있다.**

## 시스템은 도메인 특화 언어가 필요

**도메인 특화 언어(DSL)**는 간단한 스크립트 언어나 표준 언어로 구현된 API를 의미한다. DSL을 사용하면 도메인 전문가와 개발자 간의 의사소통이 원활해지고, **도메인 개념과 코드 사이의 간극**을 줄일 수 있다.<br>
좋은 DSL은 고차원 정책에서 저차원 세부 사항까지, 모든 추상화 수준과 도메인을 **POJO**로 표현할 수 있다.