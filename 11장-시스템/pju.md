(기존 내용 생략)

---

# 시스템 설계 심화 정리

> "복잡성은 죽음이다. 개발자에게서 생기를 앗아가며, 제품을 계획하고 제작하고 테스트하기 어렵게 만든다."

## 1. 시스템 제작과 시스템 사용을 분리하라

### 관심사 분리
- **관심사 분리**는 시스템을 더 이해하기 쉽고 유지보수 가능하게 만든다.
- 예: **초기화 지연(Lazy Initialization)**, **계산 지연(Lazy Evaluation)**

#### 예제 (초기화 지연)
```java
public class LazyHolder {
    private Lazy<Object> obj = new Lazy<>(() -> new Object());
}
```
- **장점**
  1. 실제로 필요할 때까지 객체를 생성하지 않음으로써 성능 최적화
  2. null 포인터 예외를 피할 수 있음

### Main 분리
- 시스템 구성과 실행 로직을 분리하여 **책임의 명확한 구분**
```java
public class App {
    public static void main(String[] args) {
        Service service = ServiceFactory.create();
        service.run();
    }
}
```
- 위 구조는 **생성과 사용을 분리한 전형적인 예시**

### 팩토리 패턴
- 객체 생성을 위임하여 **유연성과 테스트 용이성 증가**

#### Abstract Factory 패턴이란?
- 관련된 객체들을 **구체적인 클래스에 의존하지 않고 생성**할 수 있도록 인터페이스를 제공
- UI 시스템에서 Mac/Windows 스타일 컴포넌트를 교체하는 경우 유용

### 의존성 주입 (Dependency Injection)
- 객체가 직접 의존성을 생성하지 않고, **외부에서 주입받도록 설계**
- 이는 **제어 역전(IoC, Inversion of Control)** 기법의 한 형태

#### 제어 역전이란?
- **객체가 직접 로직을 제어하는 대신, 제어 권한을 외부 프레임워크가 담당**
- 모듈은 자신의 로직에만 집중하고, **보조 책임은 프레임워크가 담당**

#### JNDI(Java Naming and Directory Interface) 검색이란?
- 자바 EE 환경에서 리소스를 조회하는 방식
```java
Context ctx = new InitialContext();
DataSource ds = (DataSource) ctx.lookup("jdbc/MyDB");
```
- 일종의 **의존성 주입**이지만, **타입 안전성과 테스트 편의성은 낮다**

---

## 2. 확장 가능한 시스템 구조

> "처음부터 완벽하게 만들 수 있다는 믿음은 미신이다."

### 시스템은 점진적으로 발전해야 한다
- 아키텍처는 유연해야 하며, **필요에 따라 진화 가능해야 한다**

### EJB2 (Enterprise JavaBeans 2)
- 자바 EE 기반의 서버 컴포넌트 모델
- 컨테이너가 객체의 **생성, 생명주기, 트랜잭션, 보안 등을 자동으로 관리**

### 컨테이너란?
- 객체를 실행하는 환경을 제공하며, **의존성 주입, 설정 관리, 생명주기 제어** 등을 담당
- 대표 예시: Spring, EJB 컨테이너

### 반복적 규격 코드
- 객체 간 데이터 복사 등의 **반복 코드**는 `MapStruct`, `ModelMapper`로 **자동화 가능**

---

## 3. 횡단 관심사 (Cross-Cutting Concerns)

### 정의
- 여러 모듈에 **반복적으로 걸쳐 있는 기능**
  - 예: 보안, 로깅, 트랜잭션, 영속성

### AOP (Aspect-Oriented Programming)
- **핵심 로직과 횡단 관심사를 분리**하여 모듈화
- 시스템의 특정 동작 지점을 기준으로 관심사를 삽입

### 자바 프록시
- 프록시 패턴은 **코드 삽입 위치 명시가 어려움**
- 지나치게 사용하면 가독성이 저하됨

### 순수 자바 AOP 프레임워크
- 대표적으로 `Spring AOP`와 `AspectJ` 존재
- **Decorator 패턴**처럼 중첩 구조가 러시아 인형처럼 깊어질 수 있음

### AspectJ
- 자바 언어를 확장하여 **언어 수준에서 관점을 지원**
- 강력한 기능과 풍부한 구문을 제공하지만, **학습 곡선 존재**

---

## 4. 테스트 주도 아키텍처 구축

### TDD를 위한 아키텍처
- 테스트 가능성을 높이기 위해 **관심사를 분리**해야 함

### BDUF(Big Design Up Front)란?
- 초기에 전체 아키텍처와 기능을 결정하고 그에 따라 개발을 진행하는 방식
- 단점: **변화에 유연하지 못함**, **개발 초기 부담 큼**

### 민첩한 설계
- 단순한 구조로 시작해서 기능을 추가하며 **점진적으로 구조를 확장**

---

## 5. 의사 결정을 최적화하라
- 모듈화와 관심사 분리를 통해 **부분적이고 빠른 결정**이 가능해진다

---

## 6. 명백한 가치가 있을 때만 표준을 사용하라
- 표준은 **팀 간 통일성과 호환성**을 보장하지만
- 과도한 표준화는 **유연성을 저해**할 수 있음

---

## 7. 도메인 특화 언어 (DSL: Domain-Specific Language)

### 정의
- 특정 도메인에 최적화된 **간결하고 직관적인 표현 언어 또는 API**
- 예: SQL, HTML, 정규표현식, 테스트 DSL

### 장점
- 도메인 개념과 코드 사이의 **의사소통 간극을 줄임**
- **추상화 수준을 디자인 패턴 이상으로 끌어올릴 수 있음**

---

## ✅ 결론

- 시스템은 **단순하고 명확하게 설계**되어야 한다.
- 복잡성은 프로젝트를 **느리게 하고, 테스트 및 유지보수를 어렵게 만든다**.
- 관심사 분리, DI, 팩토리 패턴, DSL, AOP 등 다양한 도구를 활용해
  **유연하고 테스트 가능한 구조**를 설계하라.
- **BDUF를 고집하지 말고**, 진화 가능한 아키텍처로 빠르게 시작하되, 점진적으로 기반을 강화하라.
